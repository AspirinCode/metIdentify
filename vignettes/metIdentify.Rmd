---
title: "metIdentify version0.1.1"
author: "Xiaotao Shen(shenxt1990@163.com, http://shenxt.sxl.cn/)"
date: '`r Sys.Date()`'
output:
  html_document: default
  word_document: default
  pdf_document: default
vignette: |
  %\VignetteIndexEntry{Vignette Title} %\VignetteEngine{knitr::rmarkdown} %\VignetteEncoding{UTF-8}
---

## **Introduction**
******************************************

*metIdentify* provides a comprehensive pipeline for data processing and statistical analysis of large-scale mass spectrometry (MS) based-metabolomics data. 

We use the demo data from another package `demData`. Please install it before begining.

```{r,eval=FALSE,warning=FALSE, R.options=""}
if(!require(devtools)){
  install.packages("devtools")
}
devtools::install_github("jaspershen/demoData")
library(demoData)
```

## **Metabolite identification**
******************************************
MSP and MGF data are supported.

### Identifite metabolite based on MS2 library

* Prepare your MS2 data

The raw MS2 data from DDA or DIA should be transfered to msp or msp or mzXMLfiles. You can use [ProteoWizard](http://proteowizard.sourceforge.net/).

* Run `ms2Identify`

Plase your MS2 data in a folder and then set this folder as your work directory, then run `ms2Identify`. We can use the demo data from `demoData`.

```{r, eval=FALSE, message=TRUE, warning=FALSE}
library(metIdentify)
path <- system.file("identification", package = "demoData")
ms2.data <- grep(pattern = "mzXML", dir(path), value = TRUE)
setwd(path)
result <- ms2Identify(
            ms1.data = "Peak.table.csv",
            ms2.data = ms2.data,
            ms1.match.ppm = 25,
            ms2.match.ppm = 30,
            polarity = "positive",
            column = "hilic",
            dp.cutoff = 0.8,
            path = ".",
            library = "orbitrap",
            threads = 3)
```

`result` is metIdentifyClass object.

```{r, eval=FALSE,warning=FALSE}
result
```

You can get processsing parameters from it.

```{r, eval=FALSE,warning=FALSE}
parameters <- getParams(object = result)
parameters
```

You can also get the identification table from it.

```{r, eval=FALSE,warning=FALSE}
identification.table <- getIdentificationTable(object = result)
head(identification.table)
```

Then you can get all or one MS2 match plot from it.

```{r, eval=FALSE,warning=FALSE}
peak.name <- whichHasIden(object = result, dp.cutoff = 0.9)
ms2.plot <- ms2plot(object = result, which.peak = peak.name[500])
ms2.plot
```
You can also output all ms2 plot2 or some plot you want.

```{r, eval=FALSE, warning=FALSE}
peak.name <- whichHasIden(object = result, dp.cutoff = 0.9)
ms2plot(object = result,
        path = path,
        direction = "prefer.forward",
        which.peak = peak.name[1:20],
        threads = 4)
```